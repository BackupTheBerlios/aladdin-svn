<?xml version="1.0"?>

<project name="NotificationService" default="5-compress" basedir=".">

	<!-- build.override.properties hold the properties that can be customized -->
	<property file="${basedir}/build.override.properties" />
	<!-- build.properties hold the properties that should not be customized -->
	<property file="${basedir}/build.properties" />

	<!-- some properties are build from environment variables -->
	<property environment="myenv" />

	<!-- Set the uncustomizable properties -->
	<property name="src.dir" value="src" />
	<property name="bin.dir" value="build" />
	<property name="etc.dir" value="etc" />
	<property name="metainf.dir" value="${etc.dir}/META-INF" />
	<property name="webinf.dir" value="${etc.dir}/WEB-INF" />
	<property name="dist.dir" value="dist" />
	<property name="lib.dir" value="${basedir}/lib" />
	<property name="generated.metro.dir" value="generated/metro" />

	<!-- The classpath to be used to compile -->
	<path id="base.classpath">
		<pathelement location="${bin.dir}" />
		<fileset dir="${lib.dir}">
			<include name="*.jar" />
		</fileset>
		
		<fileset dir="${lib.dir}/sweb">
			<include name="*.jar" />
		</fileset>
		<fileset dir="${lib.dir}/metro"> 
							<include name="*.jar" />
		</fileset>
		<fileset dir="${lib.dir}/jboss">
			<include name="*.jar" />
		</fileset>
		<fileset dir="${lib.dir}/jaxb">
			<include name="*.jar" />
		</fileset>
		
	</path>

	<!-- clean out -->
	<target name="1-clean" description="Removes all the generated files or directories">
		<delete dir="${bin.dir}" />
		<delete dir="${dist.dir}" />
	</target>

	<!-- init cleaned out directories-->
	<target name="2-init" depends="1-clean">
		<!-- directories building -->
		<mkdir dir="${bin.dir}" />
		<mkdir dir="${dist.dir}" />
	</target>
	<!-- generate wrapper for metro -->
	<taskdef name="wsgen" classname="com.sun.tools.ws.ant.WsGen" classpathref="base.classpath"/>
	
	<target name="4b-generate-Wrapper" description="generate Wrapper for metro"  depends="4a-compile" >

		<wsgen sourcedestdir="${generated.metro.dir}/src" verbose="true" destdir="${generated.metro.dir}/build"  sei="org.sweb.notification.remote.NotificationServiceOverWS" >
		      <classpath refid="base.classpath"/>
		</wsgen>
		
		
	</target>
	<target name="5c-compress4war">
				    <jar destfile="${dist.dir}/${project.name}.war">
					<!-- WS descriptors -->
					<zipfileset dir="${webinf.dir}" prefix="WEB-INF" includes="**/*" />
					<!-- Classes -->
					<zipfileset dir="${bin.dir}" includes="**/*" />
										
					
					<!-- getting the metro WS -->
				    <zipfileset dir="${generated.metro.dir}/build" >
						<include name="org/sweb/notification/interfaces/jaxws/**/*"/>
					</zipfileset>
					
					<!-- Libs -->
					<zipfileset dir="${lib.dir}/sweb" prefix="WEB-INF/lib" includes="DocumentSchemata.jar" />
					
					
					
				</jar>
	</target>
	
	<!-- compile all java classes for EJBs --> 
	<target name="4a-compile" description="Compile the application source files" depends="2-init">
		<javac srcdir="${src.dir}" destdir="${bin.dir}" debug="${opt.javac.debug}" optimize="${opt.javac.optimize}" source="1.5">
			<classpath refid="base.classpath" />
		</javac>
	</target>

	<!-- compress to client jar -->
	<target name="5a-compress4client">
		<jar destfile="${dist.dir}/${project.name}-client.jar">
			<fileset dir="${bin.dir}">
				<include name="**/interfaces/*.class" />
				<include name="**/exceptions/*.class" />
			</fileset>
		</jar>
	</target>

	<!-- compress to JAR -->
	<target name="5b-compress4jar">
		<jar destfile="${dist.dir}/${project.name}.jar">
			<fileset dir="${bin.dir}">
				<include name="**/*.class" />
			</fileset>
			<fileset dir="${etc.dir}">
				<include name="META-INF/*.*" />
			</fileset>
			<fileset dir="classes">
				<include name="**/*.class" />
			</fileset>
			<manifest>
				<attribute name="Class-Path" value="DocumentSchemata.jar" />
			</manifest>
		</jar>
	</target>
	
	<!-- compress to EAR -->
	<target name="5d-compress4ear">
				<jar destfile="${dist.dir}/${project.name}.ear">
					
					<zipfileset dir="${metainf.dir}" prefix="META-INF" includes="**/*" />
					 <zipfileset dir="${dist.dir}" includes="${project.name}.war"  /> 
					<zipfileset dir="${dist.dir}" includes="${project.name}.jar"  />
					<zipfileset dir="${dist.dir}" prefix="lib" includes="${project.name}-client.jar" />
				</jar>
			</target>


	<!-- compress everything -->
	<target name="5-compress" depends="4b-generate-Wrapper">
		<antcall target="5a-compress4client" />
		<antcall target="5b-compress4jar" />
		<antcall target="5c-compress4war" />
		<antcall target="5d-compress4ear" />
	</target>
	
	
</project>
